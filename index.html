<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- Cropper.js CSS -->
<link  href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.css" rel="stylesheet">

<!-- Cropper.js JS -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.js"></script>

  <script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>
<script>
  UPLOADCARE_PUBLIC_KEY = '0670db5fb920e7c84fc3';
</script>
<script src="https://ucarecdn.com/libs/widget/3.x/uploadcare.full.min.js"></script>


  <title>Chief James Nyanaro ‚Äì Legacy</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      margin: 0;
      padding: 0;
      line-height: 1.6;
      background: #f9f9f9;
      color: #333;
    }
    header {
      background: #2e3a59;
      color: white;
      padding: 1.5rem;
      text-align: center;
    }
    nav a {
      color: white;
      margin: 0 15px;
      text-decoration: none;
      font-weight: bold;
      cursor: pointer;
    }
    nav a:hover {
      text-decoration: underline;
    }
    section {
      display: none;
      padding: 2rem;
      max-width: 900px;
      margin: auto;
    }
    section.active {
      display: block;
    }
    h2 {
      color: #2e3a59;
    }
    .gallery {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 1.5rem;
    }
    .gallery figure {
      background: #fff;
      padding: 1rem;
      border: 1px solid #ddd;
      border-radius: 5px;
      text-align: center;
    }
    .gallery img {
      width: 100%;
      height: auto;
      border-radius: 5px;
    }
    .tribute {
      background-color: #f2f5f7;
      border-left: 5px solid #2e3a59;
      padding: 1.5rem;
      margin-bottom: 2rem;
      border-radius: 5px;
    }
    .timeline .entry {
      border-left: 4px solid #2e3a59;
      padding-left: 1rem;
      margin-bottom: 2rem;
      position: relative;
    }
    .timeline .entry::before {
      content: "‚Ä¢";
      position: absolute;
      left: -10px;
      top: 0;
      color: #2e3a59;
      font-size: 1.5rem;
    }
    footer {
      background: #2e3a59;
      color: white;
      text-align: center;
      padding: 1rem;
      margin-top: 2rem;
    }
    #admin-controls button, #admin-content button {
      margin: 0.3rem;
      background: #1f3a5b;
      color: #fff;
      border: none;
      padding: 0.4rem 0.8rem;
      border-radius: 4px;
      cursor: pointer;
    }
    #admin-controls button:hover, #admin-content button:hover {
      background: #345678;
    }
    .admin-section {
      margin-top: 1rem;
      padding: 1rem;
      background: #f5f5f5;
      border-radius: 4px;
    }
    .drag-handle {
  cursor: grab;
  font-size: 1.5rem;
  color: #888;
  text-align: center;
  margin-bottom: 0.5rem;
}

#sortable-gallery-admin .sortable-chosen {
  background-color: #eef2fa;
  border: 2px dashed #345678;
}

#sortable-gallery-admin .sortable-ghost {
  opacity: 0.4;
}
#gallery-filters button {
  margin: 0.3rem;
  padding: 0.5rem 1rem;
  background: #2e3a59;
  color: #fff;
  border: none;
  border-radius: 4px;
  cursor: pointer;
}
#gallery-filters button:hover {
  background: #3d4b6b;
}
#gallery-filters .active-filter {
  background: #1f2c45;
  font-weight: bold;
}
@keyframes fadeUp {
  from {
    opacity: 0;
    transform: translateY(40px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

  </style>
</head>
<body>
  <audio id="welcome-audio" autoplay loop>
  <source src="audio/legacy-theme.mp3" type="audio/mp3">
  Your browser does not support the audio element.
</audio>

<div id="welcome-popup" style="
  position: fixed;
  top: 0; left: 0;
  width: 100%; height: 100%;
  background: #2e3a59;
  color: white;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  font-family: 'Segoe UI', sans-serif;
  font-size: 1.5rem;
  text-align: center;
  z-index: 3000;
  opacity: 0;
  transition: opacity 1s ease;
">
  <div style="animation: fadeUp 1.5s ease-out;">
    <p style="margin-bottom: 1rem; font-size: 1.3rem;">Welcome to the Legacy of <br><strong>Chief James Nyanaro</strong></p>
    <p style="font-size: 1rem; font-style: italic; color: #dcdcdc; margin-bottom: 2rem;">
      ‚ÄúThe greatest among you will be your servant.‚Äù ‚Äì Matthew 23:11
    </p>
    <button onclick="closeWelcomePopup()" style="
      padding: 0.6rem 1.2rem;
      font-size: 1rem;
      background: white;
      color: #2e3a59;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    ">Enter Site</button>
  </div>
</div>




<header>
  <h1>Retired Senior Chief James Nyanaro</h1>
  <marquee>Welcome! .</marquee>
  <nav>
    <a onclick="showSection('home')">Home</a>
    <a onclick="showSection('biography')">Biography</a>
    <a onclick="showSection('gallery')">Gallery</a>
    <a onclick="showSection('tributes')">Tributes</a>
    <a onclick="showSection('achievements')">Achievements</a>
   <a onclick="showSection('full-history')">Full History</a>

    <a onclick="showSection('video')">Video</a>
    <a onclick="showSection('guestbook')">Guestbook</a>
    <a onclick="showSection('admin')">Admin</a>
  </nav>
</header>

<section id="home" class="active">
  <h2>‚ÄúThe greatest among you will be your servant.‚Äù ‚Äì Matthew 23:11</h2>
  <p>Welcome to the legacy of Chief James Nyanaro ‚Äî a man of vision, faith, and service to the people of North Mugirango and beyond.</p>
</section>

<section id="biography">
  <h2>Biography</h2>
  <div id="bio-content">
    <p><strong>Early Life:</strong> ...</p>
  </div>
</section>

<section id="gallery">
  <h2>Gallery</h2>
  <div class="gallery">
    
    <figure><img src="images/chief-young.jpg" alt="Young Chief"><figcaption>Early Teaching Years</figcaption></figure>
    <div id="gallery-filters" style="text-align: center; margin-bottom: 1rem;"></div>
    <div class="gallery" id="gallery-display"></div>
  </div>
</section>

<section id="tributes">
  <h2>Tributes</h2>
  <div class="tribute"><p>"A great leader and a loving father."</p></div>
</section>

<section id="achievements">
  <h2>Achievements</h2>
  <div id="achievements-content" class="timeline">
    <div class="entry"><h3>1959 ‚Äì Primary Education</h3><p>Passed KAPE exams.</p></div>
  </div>
</section>

<section id="video">
  <h2>Video Tribute</h2>
  <iframe id="video-frame" width="560" height="315" src="https://www.youtube.com/embed/YourVideoID" frameborder="0" allowfullscreen></iframe>
</section>

<section id="guestbook">
  <h2>Guestbook</h2>
  <iframe id="guestbook-frame" src="https://docs.google.com/forms/d/e/YourFormLink/viewform?embedded=true" width="100%" height="600" frameborder="0">Loading‚Ä¶</iframe>
  <div id="guestbook-thankyou" style="
  display: none;
  margin-top: 1rem;
  padding: 1rem;
  background: #e0f7ea;
  color: #2e7d32;
  border-left: 5px solid #2e7d32;
  border-radius: 5px;
  font-weight: bold;
  text-align: center;
">
  Thank you for signing the guestbook!
</div>

</section>

<section id="admin">
  <div id="admin-login">
    <h2>Admin Panel</h2>
    <p>Enter password:</p>
    <input type="password" id="admin-pass">
    <button onclick="checkPassword()">Login</button>
    <p id="admin-error" style="color:red;"></p>
  </div>

  <div id="admin-content" style="display:none;">
    <h3>Welcome, Admin</h3>
    <div id="admin-controls">
      <button onclick="showEditSection('edit-biography')">Edit Biography</button>
      <button onclick="showEditSection('edit-achievements')">Edit Achievements</button>
      <button onclick="showEditSection('edit-video')">Manage Video</button>
      <button onclick="showEditSection('edit-guestbook')">Manage Guestbook</button>
      <button onclick="showEditSection('manage-gallery')">Gallery Manager</button>
      <button onclick="showEditSection('edit-fullhistory')">Upload Full History PDF</button>

    </div>
    <div id="edit-biography" class="admin-section" style="display:none;">
  <label for="bio-editor"><strong>Current Biography:</strong></label><br>
  <textarea id="bio-editor" rows="15" style="width: 100%; font-family: monospace;"></textarea><br>
  <button onclick="updateBiography()">Save Biography</button>
</div>

<div id="edit-achievements" class="admin-section" style="display:none;">
  <label for="achievements-editor"><strong>Current Achievements:</strong></label><br>
  <textarea id="achievements-editor" rows="12" style="width: 100%; font-family: monospace;"></textarea><br>
  <button onclick="updateAchievements()">Save Achievements</button>
</div>

    <div id="edit-video" class="admin-section" style="display:none;">
  <label for="video-url"><strong>Current YouTube Embed URL:</strong></label><br>
  <input type="text" id="video-url" style="width: 100%; padding: 0.5rem;" placeholder="https://www.youtube.com/embed/..."><br>
  <button onclick="updateVideo()">Update Video</button>
</div>

<div id="edit-guestbook" class="admin-section" style="display:none;">
  <label for="guestbook-url"><strong>Current Google Form Embed URL:</strong></label><br>
  <input type="text" id="guestbook-url" style="width: 100%; padding: 0.5rem;" placeholder="https://docs.google.com/forms/..."><br>
  <button onclick="updateGuestbook()">Update Guestbook</button>
</div>
<button onclick="showEditSection('edit-gallery')">Manage Gallery</button>

<div id="edit-gallery" class="admin-section" style="display:none;">
  <label for="image-upload"><strong>Select Image:</strong></label><br>
  <input type="file" id="image-upload" accept="image/*"><br><br>

  <label for="image-caption"><strong>Image Caption:</strong></label><br>
  <input type="text" id="image-caption" style="width: 100%; padding: 0.5rem;"><br><br>

  <button onclick="addImageToGallery()">Add to Gallery</button>
<div id="edit-fullhistory" class="admin-section" style="display: none;">
  <h4>Upload Full History PDF</h4>
  <input type="hidden" role="uploadcare-uploader" id="history-uploader" data-clearable />
  <button id="trigger-history-upload">Click to Upload PDF</button>
  <p id="history-upload-status"></p>
</div>

  <hr>
  <h4>Current Images:</h4>
  <div id="sortable-gallery-admin" class="gallery"></div>

<div id="manage-gallery" class="admin-section" style="display: none;">
  <h3>All Uploaded Images</h3>
  <div id="admin-gallery-manager" class="gallery"></div>
</div>


</div>

</section>
<div id="cropper-modal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:#000000b0; z-index:1000; align-items:center; justify-content:center;">
  <div style="background:white; padding:1rem; border-radius:8px; max-width:90%; max-height:90%;">
    <h3>Crop Image</h3>
    <img id="cropper-image" style="max-width:100%; max-height:500px;">
    <div style="margin-top: 1rem; text-align:right;">
      <button onclick="applyCrop()">Crop</button>
      <button onclick="closeCropper()">Cancel</button>
    </div>
  </div>
</div>
<div id="admin-message" style="
  display: none;
  position: fixed;
  bottom: 20px;
  left: 50%;
  transform: translateX(-50%);
  background: #2e3a59;
  color: white;
  padding: 0.8rem 1.2rem;
  border-radius: 6px;
  font-weight: bold;
  z-index: 2000;
  box-shadow: 0 0 10px rgba(0,0,0,0.2);
"></div>

  

</section>
<section id="full-history">
  <h2>Full History of Chief James Nyanaro Nyabaro</h2>

  <p>Click below to download the complete PDF biography:</p>
  <p>
    üìÇ <a href="downloads/full-history-nyanaro.pdf" download target="_blank">
      <strong>Download the Full PDF</strong>
    </a>
  </p>

  <hr>

  <h3>üìñ Bible Reference</h3>
  <blockquote>
    <p><strong>Matthew 23:11</strong><br>
    "The greatest among you will be your servant."</p>
    <p>This verse fits beautifully because Chief Nyanaro's story is one of servant leadership ‚Äî building schools, hospitals, churches, guiding people in governance and faith, and lifting his community with humility and love.</p>
  </blockquote>

  <h3>üí† Dedication</h3>
  <p>This work is lovingly dedicated to Retired Senior Chief James Nyanaro ‚Äî a father, a leader, a servant of the people, and a true hero of our time...</p>
  <!-- You can expand with full dedication content -->

  <h3>üí† Acknowledgment</h3>
  <p>I wish to sincerely acknowledge and thank Retired Senior Chief James Nyanaro, whose rich life story, tireless service, and unwavering faith have been the heart and soul of this work...</p>
  <!-- You can expand with full acknowledgment content -->

  <h3>üìë Table of Contents</h3>
  <ul>
    <li>CHAPTER 1: Early Life</li>
    <li>CHAPTER 2: Education</li>
    <li>CHAPTER 3: Working as a Teacher and Church Leader</li>
    <li>CHAPTER 4: Travel to Rome</li>
    <li>CHAPTER 5: Marriage</li>
    <li>CHAPTER 6: Chief Role and Achievements</li>
    <li>CHAPTER 7: Retirement</li>
    <li>CHAPTER 8: Appreciation</li>
    <li>Summary of Achievements</li>
    <li>Messages from Family & Community</li>
    <li>Conclusion</li>
  </ul>

  <p style="margin-top:2rem;">
    <strong>This is a legacy not just of a man, but of an entire people lifted by his vision and love.</strong>
  </p>
</section>

</section>


<marquee>Welcome! .</marquee>
<footer><p>¬© 2025 The Nyanaro Family. All rights reserved.</p></footer>


<script>
function showSection(id) {
  document.querySelectorAll("section").forEach(sec => sec.classList.remove("active"));
  document.getElementById(id).classList.add("active");
}
function checkPassword() {
  if (document.getElementById("admin-pass").value === "nyanaro123") {
    document.getElementById("admin-login").style.display = "none";
    document.getElementById("admin-content").style.display = "block";
    renderAdminPreview(); // üëà Add this line
  } else {
    document.getElementById("admin-error").textContent = "Incorrect password.";
  }
}


function logoutAdmin() {
  document.getElementById("admin-content").style.display = "none";
  document.getElementById("admin-login").style.display = "block";
  document.getElementById("admin-pass").value = "";
  document.getElementById("admin-error").textContent = "";
}
function updateBiography() {
  const newBio = document.getElementById("bio-editor").value;
  document.getElementById("bio-content").innerHTML = newBio.replace(/\n/g, "<br>");
  localStorage.setItem("bioContent", newBio);
}

function updateAchievements() {
  const newAchievements = document.getElementById("achievements-editor").value;
  document.getElementById("achievements-content").innerHTML = newAchievements.replace(/\n/g, "<br>");
  localStorage.setItem("achievementsContent", newAchievements);
}

function updateVideo() {
  const videoURL = document.getElementById("video-url").value;
  document.getElementById("video-frame").src = videoURL;
  localStorage.setItem("videoURL", videoURL);
}

function updateGuestbook() {
  const guestbookURL = document.getElementById("guestbook-url").value;
  document.getElementById("guestbook-frame").src = guestbookURL;
  localStorage.setItem("guestbookURL", guestbookURL);
}

function showEditSection(id) {
  document.querySelectorAll(".admin-section").forEach(sec => sec.style.display = "none");
  document.getElementById(id).style.display = "block";

  if (id === 'edit-biography') {
    const currentBio = document.getElementById("bio-content").innerHTML.trim();
    document.getElementById("bio-editor").value = currentBio.replace(/<br\s*\/?>/gi, "\n");
  }

  if (id === 'edit-achievements') {
    const currentAchievements = document.getElementById("achievements-content").innerHTML.trim();
    document.getElementById("achievements-editor").value = currentAchievements.replace(/<br\s*\/?>/gi, "\n");
  }

  if (id === 'edit-video') {
    const currentVideoURL = document.getElementById("video-frame").src;
    document.getElementById("video-url").value = currentVideoURL;
  }

  if (id === 'edit-guestbook') {
    const currentFormURL = document.getElementById("guestbook-frame").src;
    document.getElementById("guestbook-url").value = currentFormURL;
  }
 
  if (id === 'manage-gallery') {
  renderGalleryManager();
}
}

document.addEventListener("DOMContentLoaded", () => showSection("home"));
document.addEventListener("DOMContentLoaded", () => {
  showSection("home");

  if (localStorage.getItem("bioContent")) {
    document.getElementById("bio-content").innerHTML = localStorage.getItem("bioContent").replace(/\n/g, "<br>");
  }

  if (localStorage.getItem("achievementsContent")) {
    document.getElementById("achievements-content").innerHTML = localStorage.getItem("achievementsContent").replace(/\n/g, "<br>");
  }

  if (localStorage.getItem("videoURL")) {
    document.getElementById("video-frame").src = localStorage.getItem("videoURL");
  }

  if (localStorage.getItem("guestbookURL")) {
    document.getElementById("guestbook-frame").src = localStorage.getItem("guestbookURL");
  }
});
function addImageToGallery() {
  const fileInput = document.getElementById("image-upload");
  const caption = document.getElementById("image-caption").value.trim();

  if (fileInput.files.length === 0 || caption === "") {
    alert("Please select an image and write a caption.");
    return;
  }

  const reader = new FileReader();
  reader.onload = function(e) {
    const newImage = {
      src: e.target.result,
      caption: caption
    };

    let galleryData = JSON.parse(localStorage.getItem("galleryImages") || "[]");
    galleryData.push(newImage);
    localStorage.setItem("galleryImages", JSON.stringify(galleryData));

    renderGallery();
    renderAdminPreview();

    // Clear inputs
    fileInput.value = "";
    document.getElementById("image-caption").value = "";
  };
  reader.readAsDataURL(fileInput.files[0]);
}

function renderGallery(activeCategory = "All") {
  const galleryData = JSON.parse(localStorage.getItem("galleryImages") || "[]");

  const gallery = document.getElementById("gallery-display");
  const filters = document.getElementById("gallery-filters");

  // Build unique category list
  const categories = [...new Set(galleryData.map(img => img.category?.trim() || "Uncategorized"))];
  filters.innerHTML = `<button onclick="renderGallery('All')" class="${activeCategory === 'All' ? 'active-filter' : ''}">All</button>`;
  categories.forEach(cat => {
    filters.innerHTML += `<button onclick="renderGallery('${cat}')" class="${activeCategory === cat ? 'active-filter' : ''}">${cat}</button>`;
  });

  // Clear gallery
  gallery.innerHTML = "";

  // Filter and display
  const filteredImages = activeCategory === "All"
    ? galleryData
    : galleryData.filter(img => (img.category?.trim() || "Uncategorized") === activeCategory);

  filteredImages.forEach(image => {
    const fig = document.createElement("figure");
    fig.innerHTML = `
      <img src="${image.src}" alt="${image.caption}" style="width: ${image.size || 100}%;">
      <figcaption>${image.caption}</figcaption>
    `;
    gallery.appendChild(fig);
  });
}


function renderAdminPreview() {
  const preview = document.getElementById("sortable-gallery-admin");

  preview.innerHTML = "";

  const galleryData = JSON.parse(localStorage.getItem("galleryImages") || "[]");

  galleryData.forEach((image, index) => {
    const fig = document.createElement("figure");
  fig.setAttribute("data-index", index);

   fig.innerHTML = `
  <div class="drag-handle">‚â°</div>
  <img src="${image.src}" alt="${image.caption}" style="max-width: 100%; height: auto;"><br>
  <input type="text" id="caption-${index}" value="${image.caption}" style="width: 100%; margin: 0.3rem 0;">
  <input type="text" id="category-${index}" value="${image.category || ''}" placeholder="Category (optional)" style="width: 100%; margin-bottom: 0.5rem;">
  <label>Resize (%): <input type="number" id="size-${index}" value="${image.size || 100}" min="10" max="200" style="width: 60px;">%</label><br><br>
  <input type="file" id="replace-${index}" accept="image/*"><br><br>
  <button onclick="saveImageEdits(${index})">Save Changes</button>
  <button onclick="deleteImage(${index})" style="background: #c62828;">Delete</button>
`;



    preview.appendChild(fig);
  });
 
}
 initSortable();

function saveImageEdits(index) {
  let galleryData = JSON.parse(localStorage.getItem("galleryImages") || "[]");

  const newCaption = document.getElementById(`caption-${index}`).value;
  const newSize = parseInt(document.getElementById(`size-${index}`).value) || 100;
  const fileInput = document.getElementById(`replace-${index}`);
  const newCategory = document.getElementById(`category-${index}`).value;
  galleryData[index].category = newCategory;

  if (fileInput.files.length > 0) {
    const reader = new FileReader();
    reader.onload = function(e) {
      galleryData[index].src = e.target.result;
      galleryData[index].caption = newCaption;
      galleryData[index].size = newSize;
      localStorage.setItem("galleryImages", JSON.stringify(galleryData));
      renderGallery();
      renderAdminPreview();
    };
    reader.readAsDataURL(fileInput.files[0]);
  } else {
    galleryData[index].caption = newCaption;
    galleryData[index].size = newSize;
    localStorage.setItem("galleryImages", JSON.stringify(galleryData));
    showMessage("Image uploaded to gallery.");

    renderGallery();
    renderAdminPreview();
  }
}



function deleteImage(index) {
  if (!confirm("Are you sure you want to delete this image?")) return;

  let galleryData = JSON.parse(localStorage.getItem("galleryImages") || "[]");
  galleryData.splice(index, 1);
  localStorage.setItem("galleryImages", JSON.stringify(galleryData));
 showMessage("Image deleted.");

  renderGallery();
  renderAdminPreview();
}
function initSortable() {
  const container = document.getElementById('sortable-gallery-admin');
  if (!container) return;

  new Sortable(container, {
    animation: 150,
    handle: '.drag-handle',
    onEnd: function () {
      const items = Array.from(container.querySelectorAll('figure'));
      const newOrder = items.map(fig => parseInt(fig.dataset.index));
      let galleryData = JSON.parse(localStorage.getItem("galleryImages") || "[]");
      galleryData = newOrder.map(i => galleryData[i]);
      localStorage.setItem("galleryImages", JSON.stringify(galleryData));
      renderGallery();
      renderAdminPreview();
    }
  });
}

function renderGalleryManager() {
  const manager = document.getElementById("admin-gallery-manager");
  manager.innerHTML = "";

  const galleryData = JSON.parse(localStorage.getItem("galleryImages") || "[]");

  galleryData.forEach((image, index) => {
    const fig = document.createElement("figure");
    fig.innerHTML = `
      <img src="${image.src}" id="crop-preview-${index}" alt="${image.caption}" style="max-width: 100%; height: auto;"><br>
      <input type="text" id="edit-caption-${index}" value="${image.caption}" style="width: 100%; margin: 0.3rem 0;">
      <input type="text" id="edit-category-${index}" value="${image.category || ''}" placeholder="Category (optional)" style="width: 100%; margin-bottom: 0.5rem;">
      <label>Resize (%): <input type="number" id="edit-size-${index}" value="${image.size || 100}" min="10" max="200" style="width: 60px;"></label><br>
      <button onclick="applyEdits(${index})">Save</button>
      <button onclick="deleteImage(${index})" style="background: #c62828;">Delete</button>
      <button onclick="cropImage(${index})">Crop</button>
    `;
    manager.appendChild(fig);
  });
}

function applyEdits(index) {
  let galleryData = JSON.parse(localStorage.getItem("galleryImages") || "[]");
  galleryData[index].caption = document.getElementById(`edit-caption-${index}`).value;
  galleryData[index].category = document.getElementById(`edit-category-${index}`).value;
  galleryData[index].size = parseInt(document.getElementById(`edit-size-${index}`).value) || 100;
  localStorage.setItem("galleryImages", JSON.stringify(galleryData));
showMessage("Changes saved successfully.");

  renderGallery();
  renderAdminPreview();
  renderGalleryManager();
}
let cropper;
let cropIndex;

function cropImage(index) {
  cropIndex = index;
  const imgData = JSON.parse(localStorage.getItem("galleryImages") || "[]")[index].src;
  const imageElement = document.getElementById("cropper-image");
  imageElement.src = imgData;

  imageElement.onload = () => {
    if (cropper) cropper.destroy();
    cropper = new Cropper(imageElement, {
      aspectRatio: NaN, // Free crop
      viewMode: 1
    });

    document.getElementById("cropper-modal").style.display = "flex";
  };
}

function applyCrop() {
  if (!cropper) return;

  const canvas = cropper.getCroppedCanvas();
  const croppedData = canvas.toDataURL("image/png");

  let galleryData = JSON.parse(localStorage.getItem("galleryImages") || "[]");
  galleryData[cropIndex].src = croppedData;
  localStorage.setItem("galleryImages", JSON.stringify(galleryData));
 showMessage("Image cropped and updated.");

  closeCropper();
  renderGallery();
  renderAdminPreview();
  renderGalleryManager();
}

function closeCropper() {
  if (cropper) {
    cropper.destroy();
    cropper = null;
  }
  document.getElementById("cropper-modal").style.display = "none";
}
function showMessage(text, duration = 3000) {
  const box = document.getElementById("admin-message");
  box.textContent = text;
  box.style.display = "block";

  setTimeout(() => {
    box.style.display = "none";
  }, duration);
}
document.addEventListener("DOMContentLoaded", () => {
  showSection("home");
  renderGallery();
  renderAdminPreview();

  const storedPDF = localStorage.getItem("fullHistoryURL");
  if (storedPDF) {
    const downloadArea = document.getElementById("history-download-area");
    downloadArea.innerHTML = `
      <p>üìÇ <a href="${storedPDF}" target="_blank" download>
        Click here to download the full history of Senior Chief James Nyanaro Nyabaro
      </a></p>
    `;
  }
});

window.addEventListener("load", () => {
  const popup = document.getElementById("welcome-popup");
  setTimeout(() => {
    popup.style.opacity = 0;
    setTimeout(() => {
      popup.style.display = "none";
    }, 800);
  }, 9000); // Popup stays for 5 seconds
});
window.addEventListener("load", () => {
  const popup = document.getElementById("welcome-popup");
  popup.style.opacity = 1;
});

function closeWelcomePopup() {
  const popup = document.getElementById("welcome-popup");
  popup.style.opacity = 0;
  setTimeout(() => {
    popup.style.display = "none";
  }, 9000); // matches transition time
}
function closeWelcomePopup() {
  const popup = document.getElementById("welcome-popup");
  popup.style.opacity = 0;
  setTimeout(() => {
    popup.style.display = "none";
  }, 1000);

  // Stop audio
  const audio = document.getElementById("welcome-audio");
  if (audio) audio.pause();
}
document.getElementById("guestbook-frame").addEventListener("load", () => {
  const iframe = document.getElementById("guestbook-frame");
  const thankYouBox = document.getElementById("guestbook-thankyou");

  try {
    const currentURL = iframe.contentWindow.location.href;
    if (currentURL.includes("formResponse")) {
      thankYouBox.style.display = "block";
    }
  } catch (e) {
    // Cross-origin protection may block direct access ‚Äî fallback method:
    const iframeSrc = iframe.src;
    if (iframeSrc.includes("formResponse")) {
      thankYouBox.style.display = "block";
    }
  }
});


</script>

</body>
</html>